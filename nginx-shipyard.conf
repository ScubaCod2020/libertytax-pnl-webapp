# NGINX Configuration for Angular Apps in Shipyard
# Add this to your NGINX configuration or create as a separate config file

# This configuration should be added to your nginx.conf or as a separate .conf file
# in your /etc/nginx/conf.d/ directory (or equivalent for your setup)

server {
    listen 80;
    server_name 192.168.1.172;  # or your domain name
    
    # Shipyard location for multiple Angular apps
    location /shipyard/ {
        alias /mnt/shipyard/;  # Map this to your actual SMB mount point
        index index.html;
        
        # Try files in order: exact file, directory with index, fallback to app's index.html
        try_files $uri $uri/ $uri/index.html =404;
        
        # Enable compression for better performance
        gzip on;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
        
        # Cache static assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
        
        # Handle Angular routing for SPA apps
        location ~ ^/shipyard/([^/]+)/([^/]+)/(.*)$ {
            alias /mnt/shipyard/$1/$2/;
            try_files $3 $3/ /shipyard/$1/$2/index.html;
        }
        
        # Handle direct app access
        location ~ ^/shipyard/([^/]+)/$ {
            alias /mnt/shipyard/$1/;
            try_files index.html =404;
        }
    }
    
    # Optional: Redirect root to shipyard
    location = / {
        return 301 /shipyard/;
    }
    
    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# Alternative simpler configuration if the above is too complex:
# server {
#     listen 80;
#     server_name 192.168.1.172;
#     
#     location /shipyard/ {
#         alias /mnt/shipyard/;
#         index index.html;
#         try_files $uri $uri/ @fallback;
#     }
#     
#     location @fallback {
#         rewrite ^/shipyard/(.*)$ /shipyard/index.html last;
#     }
# }

# Docker Compose example for mounting SMB share:
# version: '3.8'
# services:
#   nginx:
#     image: nginx:latest
#     ports:
#       - "8082:80"
#     volumes:
#       - ./nginx.conf:/etc/nginx/nginx.conf
#       - type: bind
#         source: "/mnt/smbshare/shipyard"  # Your SMB mount point
#         target: "/mnt/shipyard"
#     restart: unless-stopped
