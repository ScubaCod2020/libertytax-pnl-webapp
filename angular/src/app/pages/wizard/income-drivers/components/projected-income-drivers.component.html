<div class="expense-section proj-section">
  <div class="section-title">
    <div class="title-left"><span>ðŸ“ˆ</span>Projected Performance</div>
  </div>

  <!-- Performance Change -->
  <div class="grid-row">
    <label>Performance Change</label>
    <div class="grid-field">
      <div class="inline-gap wrap">
        <!-- Scenario selector (preserved feature) -->
        <div class="scenario">
          <label for="scenario-select" class="sr-only">Scenario</label>
          <select id="scenario-select" class="select" [ngModel]="projSvc.scenario" (ngModelChange)="projSvc.setScenario($event); projSvc.applyScenarioPreset()">
            <option *ngFor="let s of scenarios" [value]="s">{{ s }}</option>
          </select>
        </div>
        <input type="number" class="input xs" step="1" min="-50" max="100" [ngModel]="projSvc.growthPct" (ngModelChange)="projSvc.setGrowthPct($event)" />
        <span>%</span>
        <select class="select">
          <option value="custom">Custom</option>
          <option value="-10">Decline: -10%</option>
          <option value="-5">Decline: -5%</option>
          <option value="0">No Change: 0%</option>
          <option value="5">Growth: +5%</option>
          <option value="10">Growth: +10%</option>
          <option value="15">Growth: +15%</option>
          <option value="20">Growth: +20%</option>
        </select>
      </div>
      <input type="range" class="range" min="-50" max="100" step="1" [ngModel]="projSvc.growthPct" (ngModelChange)="projSvc.setGrowthPct($event)" />

      <!-- Targets selection (preserved feature) -->
      <div class="targets">
        <label class="target"><input type="checkbox" [checked]="projSvc.targets.all" (change)="projSvc.toggleTarget('all', $event.target.checked)" /> Apply to All</label>
        <label class="target"><input type="checkbox" [checked]="projSvc.targets.returns" (change)="projSvc.toggleTarget('returns', $event.target.checked)" /> Returns</label>
        <label class="target"><input type="checkbox" [checked]="projSvc.targets.avgNetFee" (change)="projSvc.toggleTarget('avgNetFee', $event.target.checked)" /> Avg Net Fee</label>
        <label class="target"><input type="checkbox" [checked]="projSvc.targets.otherIncome" (change)="projSvc.toggleTarget('otherIncome', $event.target.checked)" /> Other Income</label>
        <label class="target" *ngIf="(appCfg.config$ | async)?.showTaxRush"><input type="checkbox" [checked]="projSvc.targets.taxRush" (change)="projSvc.toggleTarget('taxRush', $event.target.checked)" /> TaxRush</label>
      </div>
    </div>
  </div>

  <!-- Returns & ANF -->
  <div class="grid-row">
    <label>Tax Prep Returns</label>
    <div class="grid-field">
      <div class="inline">
        <span class="prefix">#</span>
        <input type="number" class="input sm" 
               [ngModel]="taxPrepReturns$ | async" 
               (ngModelChange)="updateTaxPrepReturns($event)"
               placeholder="e.g., 1,680" />
      </div>
    </div>
  </div>
  
  <div class="grid-row">
    <label>Average Net Fee</label>
    <div class="grid-field">
      <div class="inline">
        <span class="prefix">$</span>
        <input type="number" class="input sm" 
               [ngModel]="avgNetFee$ | async" 
               (ngModelChange)="updateAvgNetFee($event)"
               placeholder="e.g., 130" />
      </div>
    </div>
  </div>

  <!-- Gross (derived unless override) -->
  <div class="grid-row">
    <label>Gross Tax Prep Fees</label>
    <div class="grid-field">
      <div class="inline">
        <span class="prefix">$</span>
        <input type="number" class="input sm" 
               [ngModel]="grossFees$ | async" 
               (ngModelChange)="overrideGrossFees($event)"
               placeholder="Auto-calculated" />
      </div>
    </div>
  </div>

  <!-- Discounts -->
  <div class="grid-row">
    <label>Customer Discounts</label>
    <div class="grid-field">
      <div class="inline-gap">
        <div class="inline">
          <span class="prefix">$</span>
          <input type="number" class="input xs" 
                 min="0" step="1" 
                 [ngModel]="discountsAmt$ | async" 
                 (ngModelChange)="updateDiscountsAmt($event)"
                 placeholder="6000" />
        </div>
        <span class="eq">=</span>
        <div class="inline">
          <input type="number" class="input xs" 
                 step="0.1" min="0" max="20" 
                 [ngModel]="discountsPct$ | async" 
                 (ngModelChange)="updateDiscountsPct($event)"
                 placeholder="3.0" />
          <span class="suffix">%</span>
        </div>
      </div>
      <div class="help italic">Default: 3% â€¢ Enter either dollar amount or percentage â€” the other will auto-calc</div>
    </div>
    <div class="small note">Dollar amount or % of gross fees given as discounts. Enter either field; the other auto-calculates.</div>
  </div>

  <!-- Total Tax Prep Income (projected) -->
  <div class="grid-row">
    <label>Total Tax Prep Income</label>
    <div class="grid-field">
      <div class="inline">
        <span class="prefix">$</span>
        <input type="number" class="input sm" 
               [ngModel]="taxPrepIncome$ | async" 
               (ngModelChange)="overrideTaxPrepIncome($event)"
               placeholder="Auto-calculated" />
      </div>
    </div>
    <div class="small note">Gross âˆ’ Discounts (clear to re-auto)</div>
  </div>

  <!-- Other Income (projected) -->
  @if (settings.settings.otherIncome) {
  <div class="grid-row">
    <label>Other Income</label>
    <div class="grid-field">
      <div class="inline">
        <span class="prefix">$</span>
        <input type="number" class="input sm" 
               [ngModel]="otherIncome$ | async" 
               (ngModelChange)="updateOtherIncome($event)" />
      </div>
    </div>
  </div>
  }

  <!-- Total Expenses (projected) -->
  <div class="grid-row">
    <label>Total Expenses</label>
    <div class="grid-field">
      <div class="inline">
        <span class="prefix">$</span>
        <input type="number" class="input sm readonly" 
               [ngModel]="totalExpenses$ | async" 
               placeholder="Auto-calculated" />
      </div>
    </div>
    <div class="small note">Auto: (Tax Prep Income + Other Income) Ã— 76%</div>
  </div>

  <!-- TaxRush (projected) - optional block preserved -->
  @if ((appCfg.config$ | async)?.showTaxRush) {
  <div class="box info">
    <div class="box-title">TaxRush (Projected)</div>
    <div class="row compact"><label>TaxRush Returns</label><div class="field"><input type="number" class="input" placeholder="240" /></div></div>
    <div class="row compact"><label>TaxRush Avg Net Fee</label><div class="field"><div class="currency"><span class="prefix">$</span><input type="number" class="input" placeholder="125" /></div></div></div>
    <div class="row compact"><label>TaxRush Gross Fees</label><div class="field"><div class="currency"><span class="prefix">$</span><input type="number" class="input" placeholder="Auto-calculated" /></div></div></div>
  </div>
  }

  <!-- Summary banner -->
  <div class="net-banner green">
    Projected Net Income: ${{ (netIncome$ | async) | number:'1.0-0' }} 
    <span class="muted">({{ (netMargin$ | async) | number:'1.1-1' }}% margin)</span>
  </div>
</div>

<!-- Analysis Block (dev-visible; feature gated) -->
<section class="card" *ngIf="showAnalysis">
  <div class="card-title">Analysis</div>
  <lt-analysis-block [data]="analysisData" size="medium"></lt-analysis-block>
  <div class="small" style="color:#6b7280">Dev-only: compares Custom vs selected preset</div>
</section>


